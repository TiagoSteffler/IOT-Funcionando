<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Management System - ESP32</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üåê Sistema de Gerenciamento IoT</h1>
            <p class="subtitle">Monitoramento de Dispositivos ESP32 via MQTT</p>
        </header>

        <!-- Dashboard Stats -->
        <section class="stats-section">
            <div class="stat-card">
                <div class="stat-icon">üì±</div>
                <div class="stat-info">
                    <h3 id="total-devices">0</h3>
                    <p>Total de Dispositivos</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-info">
                    <h3 id="online-devices">0</h3>
                    <p>Dispositivos Online</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-info">
                    <h3 id="total-readings">0</h3>
                    <p>Leituras de Sensores</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-info">
                    <h3 id="active-automations">0</h3>
                    <p>Automa√ß√µes Ativas</p>
                </div>
            </div>
        </section>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('devices')">Dispositivos</button>
            <button class="tab-button" onclick="showTab('automations')">Automa√ß√µes</button>
            <button class="tab-button" onclick="showTab('add-device')">Adicionar Dispositivo</button>
        </div>

        <!-- Devices Tab -->
        <section id="devices-tab" class="tab-content active">
            <div class="section-header">
                <h2>Dispositivos Registrados</h2>
                <button class="btn btn-primary" onclick="refreshDevices()">üîÑ Atualizar</button>
            </div>
            <div id="devices-list" class="devices-grid"></div>
        </section>

        <!-- Automations Tab -->
        <section id="automations-tab" class="tab-content">
            <div class="section-header">
                <h2>Automa√ß√µes e Rotinas</h2>
                <button class="btn btn-primary" onclick="showAddAutomation()">‚ûï Nova Automa√ß√£o</button>
            </div>
            
            <div id="add-automation-form" class="form-container" style="display: none;">
                <h3>Criar Nova Automa√ß√£o</h3>
                <form onsubmit="createAutomation(event)">
                    <div class="form-group">
                        <label for="auto-name">Nome da Automa√ß√£o:</label>
                        <input type="text" id="auto-name" required>
                    </div>
                    <div class="form-group">
                        <label for="auto-device">Dispositivo:</label>
                        <select id="auto-device" required></select>
                    </div>
                    <div class="form-group">
                        <label for="auto-sensor">Tipo de Sensor:</label>
                        <select id="auto-sensor" required>
                            <option value="temperature">Temperatura</option>
                            <option value="humidity">Umidade</option>
                            <option value="pressure">Press√£o</option>
                            <option value="light">Luz</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="auto-condition">Condi√ß√£o:</label>
                        <select id="auto-condition" required>
                            <option value="greater">Maior que</option>
                            <option value="less">Menor que</option>
                            <option value="equal">Igual a</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="auto-threshold">Valor Limite:</label>
                        <input type="number" id="auto-threshold" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label for="auto-action">A√ß√£o (comando):</label>
                        <input type="text" id="auto-action" placeholder="Ex: LED_ON, ALARM, etc." required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Criar Automa√ß√£o</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAddAutomation()">Cancelar</button>
                    </div>
                </form>
            </div>

            <div id="automations-list" class="automations-list"></div>
        </section>

        <!-- Add Device Tab -->
        <section id="add-device-tab" class="tab-content">
            <div class="form-container">
                <h2>Registrar Novo Dispositivo</h2>
                <form onsubmit="registerDevice(event)">
                    <div class="form-group">
                        <label for="device-id">ID do Dispositivo (ESP32):</label>
                        <input type="text" id="device-id" placeholder="Ex: ESP32_001" required>
                        <small>Use um identificador √∫nico para o ESP32</small>
                    </div>
                    <div class="form-group">
                        <label for="device-name">Nome do Dispositivo:</label>
                        <input type="text" id="device-name" placeholder="Ex: Sensor Sala Principal" required>
                    </div>
                    <div class="form-group">
                        <label for="device-type">Tipo:</label>
                        <select id="device-type">
                            <option value="ESP32">ESP32</option>
                            <option value="ESP32-CAM">ESP32-CAM</option>
                            <option value="ESP32-WROVER">ESP32-WROVER</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="device-location">Localiza√ß√£o:</label>
                        <input type="text" id="device-location" placeholder="Ex: Sala de Estar">
                    </div>
                    <button type="submit" class="btn btn-primary">Registrar Dispositivo</button>
                </form>

                <div class="info-box">
                    <h3>‚ÑπÔ∏è Configura√ß√£o do ESP32</h3>
                    <p>Configure seu ESP32 para enviar dados via MQTT:</p>
                    <ul>
                        <li><strong>Broker MQTT:</strong> test.mosquitto.org (ou configure o seu pr√≥prio)</li>
                        <li><strong>T√≥pico de Dados:</strong> iot-funcionando/{device_id}/data</li>
                        <li><strong>T√≥pico de Status:</strong> iot-funcionando/{device_id}/status</li>
                        <li><strong>T√≥pico de Comandos:</strong> iot-funcionando/{device_id}/command</li>
                    </ul>
                    <p>Formato JSON de dados esperado:</p>
                    <pre>{"temperature": 25.5, "humidity": 60, "pressure": 1013, "light": 450}</pre>
                </div>
            </div>
        </section>
    </div>

    <!-- Device Details Modal -->
    <div id="device-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeviceModal()">&times;</span>
            <h2 id="modal-device-name"></h2>
            <div id="modal-device-details"></div>
            <div id="modal-sensor-data"></div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="sendDeviceCommand()">üì§ Enviar Comando</button>
                <button class="btn btn-secondary" onclick="closeDeviceModal()">Fechar</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
